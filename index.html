<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>كلمة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');
        
        * {
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --correct-color: #6ca965;
            --present-color: #c8b653;
            --absent-color: #787c7e;
            --default-color: #d3d6da;
            --bg-color: #ffffff;
            --text-color: #000000;
            --border-color: #d3d6da;
            --key-bg: #d3d6da;
            --key-text: #000000;
            --tile-size: 4rem;
            --key-height: 3.2rem;
        }

        .dark-mode {
            --correct-color: #538d4e;
            --present-color: #b59f3b;
            --absent-color: #3a3a3c;
            --default-color: #818384;
            --bg-color: #121213;
            --text-color: #ffffff;
            --border-color: #3a3a3c;
            --key-bg: #818384;
            --key-text: #ffffff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* تحسين حجم البلاطات بشكل ديناميكي */
        .tile {
            width: var(--tile-size);
            height: var(--tile-size);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: calc(var(--tile-size) * 0.6);
            font-weight: 800;
            user-select: none;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        /* أحجام مختلفة للشاشات */
        @media (max-width: 1024px) {
            :root {
                --tile-size: 3.5rem;
                --key-height: 2.8rem;
            }
        }

        @media (max-width: 768px) {
            :root {
                --tile-size: 3.2rem;
                --key-height: 2.6rem;
            }
        }

        @media (max-width: 640px) {
            :root {
                --tile-size: 2.8rem;
                --key-height: 2.4rem;
            }
        }

        @media (max-width: 480px) {
            :root {
                --tile-size: 2.5rem;
                --key-height: 2.2rem;
            }
        }

        @media (max-width: 380px) {
            :root {
                --tile-size: 2.3rem;
                --key-height: 2rem;
            }
        }

        @media (max-width: 320px) {
            :root {
                --tile-size: 2rem;
                --key-height: 1.8rem;
            }
        }

        /* للشاشات العريضة */
        @media (min-width: 1025px) and (min-height: 700px) {
            :root {
                --tile-size: 4.5rem;
                --key-height: 3.5rem;
            }
        }

        .tile.filled {
            border-color: #878a8c;
            animation: pop 0.1s ease;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .tile.correct {
            background-color: var(--correct-color);
            border-color: var(--correct-color);
            color: white;
        }

        .tile.present {
            background-color: var(--present-color);
            border-color: var(--present-color);
            color: white;
        }

        .tile.absent {
            background-color: var(--absent-color);
            border-color: var(--absent-color);
            color: white;
        }

        .flip {
            animation: flip 0.6s ease;
        }

        @keyframes flip {
            0% { transform: rotateX(0); }
            50% { transform: rotateX(90deg); }
            100% { transform: rotateX(0); }
        }

        /* تحسين لوحة المفاتيح بشكل ديناميكي */
        .key {
            height: var(--key-height);
            min-width: calc(var(--key-height) * 0.8);
            background-color: var(--key-bg);
            color: var(--key-text);
            border: none;
            border-radius: 6px;
            font-weight: 700;
            font-size: calc(var(--key-height) * 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            touch-action: manipulation;
            padding: 0 6px;
            margin: 2px;
            flex: 1;
        }

        .key:hover, .key:active {
            opacity: 0.9;
            transform: scale(0.98);
        }

        .key.wide {
            min-width: calc(var(--key-height) * 1.6);
            font-size: calc(var(--key-height) * 0.3);
            font-weight: 600;
        }

        .key.correct {
            background-color: var(--correct-color);
            color: white;
        }

        .key.present {
            background-color: var(--present-color);
            color: white;
        }

        .key.absent {
            background-color: var(--absent-color);
            color: white;
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .bounce {
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        .stats-bar {
            height: 32px;
            background-color: var(--absent-color);
            color: white;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            margin: 2px 0;
        }

        /* تحسينات خاصة للشاشات القصيرة */
        @media (max-height: 700px) {
            :root {
                --tile-size: 2.5rem;
                --key-height: 2.2rem;
            }
            
            header {
                padding: 0.5rem 1rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .grid-rows-8 {
                gap: 0.25rem;
            }
            
            #keyboard {
                margin-top: 0.5rem;
                padding: 0 0.25rem;
            }
            
            .key-row {
                margin-bottom: 0.25rem;
            }
        }

        @media (max-height: 600px) {
            :root {
                --tile-size: 2.2rem;
                --key-height: 2rem;
            }
            
            #message {
                margin-bottom: 0.5rem;
                height: 1.5rem;
                font-size: 0.9rem;
            }
        }

        /* تحسين التمرير على الجوال */
        html {
            -webkit-overflow-scrolling: touch;
        }

        /* تحسين الأداء */
        .tile, .key {
            will-change: transform;
        }

        /* إخفاء شريط التمرير في بعض المتصفحات */
        ::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        /* تحسين الضغط على الأزرار */
        button {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* تحسين المسافات */
        .grid-rows-8 {
            gap: 0.5rem;
        }

        @media (max-width: 640px) {
            .grid-rows-8 {
                gap: 0.4rem;
            }
        }

        @media (max-width: 480px) {
            .grid-rows-8 {
                gap: 0.3rem;
            }
        }

        /* تحسين الهيدر */
        header {
            padding: 1rem;
            min-height: 4rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        @media (max-width: 640px) {
            h1 {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.6rem;
            }
        }

        .icon-btn {
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background-color: var(--default-color);
        }

        /* تحسين المسافات الرئيسية */
        main {
            padding: 1rem 0.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: calc(100vh - 4rem);
        }

        #message {
            min-height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 0.5rem;
        }

        @media (max-width: 480px) {
            #message {
                font-size: 1rem;
                min-height: 2rem;
            }
        }

        #keyboard {
            margin-top: auto;
            padding: 0.5rem;
            width: 100%;
        }

        .key-row {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        @media (max-width: 480px) {
            .key-row {
                gap: 0.2rem;
                margin-bottom: 0.4rem;
            }
        }

        /* تحسين النوافذ المنبثقة للجوال */
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* منع التكبير على الجوال */
        input, textarea, select {
            font-size: 16px;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="flex items-center justify-between px-4 py-4 border-b border-[var(--border-color)]">
        <div class="flex items-center space-x-2 space-x-reverse">
            <button id="helpBtn" class="icon-btn">
                <i class="fas fa-question-circle text-xl"></i>
            </button>
            <button id="statsBtn" class="icon-btn">
                <i class="fas fa-chart-bar text-xl"></i>
            </button>
        </div>
        
        <h1 class="text-2xl font-bold text-center flex-1 px-2">كلمة</h1>
        
        <div class="flex items-center space-x-2 space-x-reverse">
            <button id="settingsBtn" class="icon-btn">
                <i class="fas fa-cog text-xl"></i>
            </button>
            <button id="themeToggle" class="icon-btn">
                <i class="fas fa-moon text-xl"></i>
            </button>
        </div>
    </header>

    <!-- Game Grid -->
    <main>
        <div id="message" class="mb-2"></div>
        <div id="grid" class="grid grid-rows-8 gap-2 mb-4 flex justify-center"></div>
        
        <!-- Keyboard -->
        <div id="keyboard" class="w-full max-w-2xl mx-auto"></div>
    </main>

    <!-- Modals -->
    <div id="helpModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden p-4">
        <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-xl w-full max-w-md modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">كيفية اللعب</h2>
                    <button id="closeHelp" class="text-2xl hover:text-[var(--absent-color)] transition">&times;</button>
                </div>
                
                <p class="mb-4 text-lg">تخمّن الكلمة في 8 محاولات</p>
                <p class="mb-6 text-lg">بعد كل تخمين، يتغير لون البلاطات ليعطيك تلميحات</p>
                
                <div class="space-y-4 mb-6">
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="tile correct" style="width: 3rem; height: 3rem; font-size: 1.8rem;">ن</div>
                        <p class="text-lg">الحرف <strong>ن</strong> في مكانه الصحيح</p>
                    </div>
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="tile present" style="width: 3rem; height: 3rem; font-size: 1.8rem;">ع</div>
                        <p class="text-lg">الحرف <strong>ع</strong> موجود في الكلمة ولكن في مكان آخر</p>
                    </div>
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="tile absent" style="width: 3rem; height: 3rem; font-size: 1.8rem;">ا</div>
                        <p class="text-lg">الحرف <strong>ا</strong> غير موجود في الكلمة</p>
                    </div>
                </div>
                
                <p class="mb-6 text-lg"><strong>ملاحظة:</strong> النظام يميز بين الحروف المختلفة (أ، إ، آ، ا، ة، ه)</p>
                
                <div class="text-center">
                    <button id="startGameBtn" class="bg-[var(--correct-color)] text-white px-8 py-3 rounded-lg font-bold hover:opacity-90 transition text-lg w-full">
                        بدء لعبة جديدة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="statsModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden p-4">
        <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">الإحصائيات</h2>
                    <button id="closeStats" class="text-2xl hover:text-[var(--absent-color)] transition">&times;</button>
                </div>
                
                <div class="flex justify-around mb-8">
                    <div class="text-center">
                        <div id="playedCount" class="text-3xl font-bold">0</div>
                        <div class="text-sm mt-1">العب</div>
                    </div>
                    <div class="text-center">
                        <div id="winPercent" class="text-3xl font-bold">0%</div>
                        <div class="text-sm mt-1">فوز</div>
                    </div>
                    <div class="text-center">
                        <div id="currentStreak" class="text-3xl font-bold">0</div>
                        <div class="text-sm mt-1">تتابع</div>
                    </div>
                    <div class="text-center">
                        <div id="maxStreak" class="text-3xl font-bold">0</div>
                        <div class="text-sm mt-1">أعلى تتابع</div>
                    </div>
                </div>
                
                <h3 class="font-bold mb-3 text-lg">توزيع التخمينات</h3>
                <div id="guessDistribution" class="space-y-1 mb-6"></div>
                
                <div class="space-y-3">
                    <button id="shareBtn" class="w-full bg-[var(--correct-color)] text-white py-3 rounded-lg font-bold hover:opacity-90 transition text-lg">
                        <i class="fas fa-share-alt ml-2"></i> مشاركة النتيجة
                    </button>
                    <button id="newGameBtn" class="w-full border-2 border-[var(--border-color)] py-3 rounded-lg font-bold hover:bg-[var(--default-color)] transition text-lg">
                        لعبة جديدة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden p-4">
        <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">الإعدادات</h2>
                    <button id="closeSettings" class="text-2xl hover:text-[var(--absent-color)] transition">&times;</button>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between py-2">
                        <span class="text-lg">الوضع الليلي</span>
                        <label class="switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between py-2">
                        <span class="text-lg">صوت التأثيرات</span>
                        <label class="switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    
                    <div class="pt-4 border-t border-[var(--border-color)]">
                        <h3 class="font-bold mb-3 text-lg">اختر صعوبة الكلمة:</h3>
                        <div class="space-y-3">
                            <label class="flex items-center py-2">
                                <input type="radio" name="difficulty" value="easy" checked class="ml-3 w-5 h-5">
                                <span class="text-lg">سهلة (كلمات شائعة)</span>
                            </label>
                            <label class="flex items-center py-2">
                                <input type="radio" name="difficulty" value="medium" class="ml-3 w-5 h-5">
                                <span class="text-lg">متوسطة</span>
                            </label>
                            <label class="flex items-center py-2">
                                <input type="radio" name="difficulty" value="hard" class="ml-3 w-5 h-5">
                                <span class="text-lg">صعبة (كلمات نادرة)</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 text-center">
                    <button id="resetStatsBtn" class="text-red-500 hover:text-red-700 transition text-lg py-2">
                        <i class="fas fa-trash-alt ml-2"></i> إعادة تعيين الإحصائيات
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // قائمة الكلمات العربية
        const WORD_LIST = [
         "طاولة", "مكتبة", "تفاحة", "خزانة", "نافذة", "شاشات", "أبواب", "أقلام", "أوراق", "دفاتر", "مسطرة", "مفتاح", "سيارة", "طيارة", "دراجة", "حافلة", "شاحنة", "باخرة", "سفينة", "محطات", "مدينة", "قريات", "حديقة", "غابات", "صحراء", "هضبات", "أنهار", "أمواج", "كواكب", "أتربة", "أحجار", "أشجار", "أزهار", "وردات", "نخلات", "أعناب", "موزات", "جزرات", "بصلات", "ليمون", "خوخات", "توتات", "رمانة", "بطيخة", "نعناع", "موهوب", "ينبوع", "كوادر", "طاووس", "عشرون", "ذوبان", "مبارك", "عوجاء", "معطاء", "ليونة", "بضاعة", "نصيحة", "توجيه", "بنتان", "ظرفاء", "بادية", "مرايا", "مادية", "شفعاء", "بائقة", "كابوس", "تلاوة", "مذاعة", "مقالة", "مسمار", "باكورة", "مرساة", "مراجع", "كارثة", "تابوت", "شواغر", "نواهي", "نوايا", "غلاظة", "ريحان", "وجيزة", "نقاهة", "نكراء", "تاريخ", "طاغوت", "وسطاء", "ولادة", "ترضية", "توصية", "خضراء", "باحثة", "منطاد", "مقولة", "مجنحة", "مؤدبة", "تعيسة", "مبتسم", "وكلاء", "عنقاء", "تابعة", "نشطاء", "براقة", "ميزان", "ثرثار", "جيران", "باهية", "مطبوع", "توظيف", "فنجان", "ماضية", "مبسطة", "مصفاة", "قمامة", "حيوان", "جاسوس", "رمضان", "عصفور", "مهارة", "مشوشة", "تنقيب", "مترفة", "عزباء", "عذراء", "زعماء", "محلات", "ترقية", "تمائل", "ميلاد", "بلدان", "توضيح", "ريغان", "وسيمة", "مذاهب", "فضيحة", "مصونة", "مرجان", "مباحة", "متحور", "باعثة", "زملاء", "مثمرة", "مقدمة", "كرماء", "تسلية", "مشاكس", "عميقة", "مهينة", "توديع", "تشرذم", "توفير", "تاجرة", "وهنية", "قانون", "ملونة", "محدود", "لطفاء", "وصاية", "متعال", "مؤذية", "نظيفة", "شرفاء", "حمراء", "ناموس", "مأمون", "مسافر", "بدانة", "توصيل", "لفافة", "جاموس", "مباني", "فواكه", "صابون", "غلمان", "مجرات", "ثقافة", "تائبة", "تأسيس", "توفيق", "ميناء", "مجيدة", "وزراء", "مباحث", "وكيلة", "تضارب", "متيمة", "تسوية", "تائهة", "علماء", "ميقات", "معيشة", "بائعة", "ديوان", "صاروخ", "تعبئة", "فانوس", "تفاهة", "مأكول", "ماشية", "باهتة", "مؤيدة", "وكالة", "بطلان", "كنيسة", "مجدية", "قرنفل", "خواطر", "مجتاز", "غرامة", "معتدل", "عواطف", "زخارف", "ملامح", "عامود", "مناعة", "عصفور", "معلقة", "زرارة", "معقول", "زراعة", "تمثيل", "سداسي", "مهاجر", "جراحة", "معاكس", "شبيبة", "معابد", "مجاهد", "تجريب", "مواقد", "شريفة", "عنصري", "مساجد", "سلامة", "بطيخة", "سجادة", "رزيبة", "شحادة", "حفلات", "لطافة", "تعنيف", "متاحف", "راغبة", "معزوم", "تسلسل", "سلاحف", "مدارس", "مستور", "رباعي", "تعريف", "مواقف", "هيفاء", "ثخينة", "تحميل", "مكاتب", "علامة", "مواقع", "ثنائي", "لطيفة", "تسبيح", "مجالس", "توريد", "معاهد", "مصاحب", "رفيعة", "تحفيز", "مكتبة", "بوصلة", "كلمات", "دائرة", "مسموح", "شعراء", "زرعات", "سذاجة", "سميحة", "همسات", "جرافة", "دراجة", "مختبر", "مكياج", "مسلسل", "تصريح", "صحابة", "فارقة", "خماسي", "مجموع", "مثبتة", "ممتعة", "مماثل", "عائدة", "صناعة", "ممنوع", "مصاحف", "مكافح", "تقنية", "مجروح", "صحيحة", "فارسة", "شوائب", "ثلاثي", "مواكب", "زهراء", "سهولة", "متاجر", "صفراء", "خاطئة", "توهيد", "كهيلة", "الستة", "صعوبة", "مربعة", "مجوهر", "مقاعد", "مطروح", "مكتوب", "هادفة", "مدافع", "شبابي", "ترهيب", "جريح", "كهولة", "سجينة", "معدات", "لوحات", "هجرات", "عفراء", "مشاعر", "مرادف", "خنساء", "مدروس", "كواشف", "عباءة", "محتوى", "حلقات", "كريمة", "تسنيم", "مهنية", "شاحبة", "عصيبة", "مقتول", "موصول", "معينة", "محبوب", "باسطة", "سابقة", "مخطط", "جاهلة", "مقطور", "غفلان", "مجبور", "نشطاء", "مبعوث", "ظالمة", "محاول", "تورية", "مجاوز", "مخشية", "أجزاء", "مشيئة", "ثكلان", "موهوم", "ناضجة", "أعيان", "مغروم", "فاتحة", "منقوص", "فائحة", "مبروم", "حاكمة", "ميزان", "محسوب", "خطيرة", "محمول", "بارزة", "موشوم", "منطوق", "ساجدة", "مرصوص", "تيجان", "محمود", "إطراء", "مدموج", "ظافرة", "ملكوم", "عرفان", "مقصود", "مجزية", "إبداء", "مهنية", "واعدة", "تأميم", "لاقطة", "معدوم", "صابرة", "مكلوم", "طاعة", "مرزوق", "حاضنة", "متفوق", "ظاهرة", "تأويل", "شامخة", "تلقاء", "مبعوث", "فاحصة", "مأبون", "راسخة", "مجدوب", "طارحة", "ملموس", "نابعة", "مرسوم", "إبقاء", "مأثوم", "عمران", "حاسمة", "مراود", "محروق", "إذعان", "مثقوب", "واثقة", "محروم", "فائزة", "متبوع", "تنمية", "مخطط", "ناقضة", "مخصوص", "رجحان", "متذوق", "وجدان", "مأثور", "مجروح", "مليئة", "محفوف", "شاكرة", "خاتمة", "معمور", "صادقة", "صانعة", "محروس", "مصيدة", "شكران", "مقصور", "سامعة", "توشية", "ديوان", "مختوم", "زاهدة", "متكون", "مرينة", "معمول", "إرضاء", "متجول", "مريعة", "طلقاء", "متكور", "شافية", "محصور", "باهتة", "مخروط", "مدينة", "محظور", "ذؤبان", "مجرور", "سانحة", "أشجان", "مبرود", "واطئة", "محجوز", "سلطان", "مديدة", "مأذون", "صامتة", "مخدوش", "حاملة", "كتمان", "ساعية", "مبعوث", "حاصلة", "مجموع", "قربان", "مسموم", "أبناء", "مهزوز", "منصوص", "شاهقة", "محسوم", "ناطقة", "تأييد", "محاور", "تعميم", "أحباء", "مكيدة", "مأمون", "رادعة", "متلوف", "ناضرة", "مخبول", "ناضحة", "مبروك", "تسوية", "مقصوص", "عاجزة", "محسوس", "جدران", "متخوف", "مقبوض", "واعية", "محبور", "فاسدة", "محكوم", "لاصقة", "مبخوت", "صادمة", "محصود", "مخروق", "عادلة", "محبوس", "مأخوذ", "مقطوع", "مقذوف", "رهبان", "غامرة", "ثعبان", "متشوق", "ناجعة", "متقوس", "خاضعة", "محشور", "طاهرة", "محسود", "فرقان", "ملغوم", "سرعان", "مقطوف", "نبلاء", "مانعة", "محشود", "اتقان", "محصول", "مظلوم", "خافضة", "ملصوق", "ريغان", "مصقول", "محروز", "محدود", "سيلان", "متزوج", "إعلاء", "منقوض", "مريرة", "مجلوب", "حاشدة", "مأجور", "صاحبة", "متعوس", "ريحان", "مبغوض", "راجفة", "منقوط", "بارعة", "مجحود", "خارقة", "متلون", "صاعدة", "حازمة", "محظوظ", "صارخة", "مغمود", "هذيان", "متروك", "صبيان", "محموم", "باسمة", "محلول", "ساخطة", "محذوف", "غارقة", "تأمين", "داحضة", "معيبة", "بنيان", "مجعول", "ثاقبة", "مديون", "حائزة", "مبذول", "راجية", "محبوك", "نافثة", "مأجوج", "طاحنة", "مجزوم", "بسطاء", "محجور", "حامدة", "مجاور", "هابطة", "مثلوج", "سبحان", "عارمة", "نسيان", "مثبوت", "سرطان", "مأهول", "نيران", "مخطوب", "ناصعة", "محفور", "أخطاء", "مهيبة", "عدوان", "طامحة", "إعفاء", "مقروض", "عازفة", "غفران", "حافظة", "إقصاء", "بادرة", "محقون", "خادعة", "مهموم", "حاشرة", "عصيان", "سابحة", "مأمور", "إعطاء", "فارسة", "خافقة", "ثلاثة", "أربعة", "تذكرة", "شجيرة", "ضيافة", "تدفئة", "أسبوع", "أرواح", "ضوضاء", "أعضاء", "اثنان", "أسماء", "زمكان", "تدبير", "معجون", "تجميل", "رادار", "تقارب", "معماري", "تبريد", "طيبة", "لطيفة", "عذبة", "هادئة", "واضحة", "بهيجة", "رشيقة", "ناعمة", "صافية", "دافئة", "بسيطة", "شامخة", "كريمة", "صادقة", "وفية", "رزينة", "عطرة", "بهية", "نابعة", "غالية", "فخمة", "حذرة", "رقيقة", "سخية", "مهمة", "حكيمة", "مطلقة", "نبيلة", "مقدسة", "سعيدة", "غنية", "منيرة", "مشرقة", "فاضلة", "عاقلة", "واعية", "راقية", "سامية", "نقية", "زكية", "عفيفة", "شريفة", "وقورة", "هيوبة", "مهيبة", "جليلة", "عظيمة", "سمحة", "رحبة", "ودودة", "حنونة", "شفوقة", "رؤوفة", "غفورة", "ستارة", "حصيفة", "مدبرة", "محسنة", "منصفة", "متبعة", "قوامة", "حافظة", "ناصحة", "مرشدة", "موجهة", "كافية", "واقية", "عاصمة", "مانعة", "جاعلة", "رافعة", "خافضة", "قاضية", "حاكمة", "عادلة", "ناهية", "آمرة", "زاجرة", "وازعة", "رادعة", "صارمة", "لينة", "يانعة", "نامية", "واعدة", "باسطة", "قابضة", "نافعة
        ];

        // قاموس موسع للتحقق
        const DICTIONARY = [...new Set(WORD_LIST)].concat(["طاولة", "مكتبة", "تفاحة", "خزانة", "نافذة", "شاشات", "أبواب", "أقلام", "أوراق", "دفاتر", "مسطرة", "مفتاح", "سيارة", "طيارة", "دراجة", "حافلة", "شاحنة", "باخرة", "سفينة", "محطات", "مدينة", "قريات", "حديقة", "غابات", "صحراء", "هضبات", "أنهار", "أمواج", "كواكب", "أتربة", "أحجار", "أشجار", "أزهار", "وردات", "نخلات", "أعناب", "موزات", "جزرات", "بصلات", "ليمون", "خوخات", "توتات", "رمانة", "بطيخة", "نعناع", "موهوب", "ينبوع", "كوادر", "طاووس", "عشرون", "ذوبان", "مبارك", "عوجاء", "معطاء", "ليونة", "بضاعة", "نصيحة", "توجيه", "بنتان", "ظرفاء", "بادية", "مرايا", "مادية", "شفعاء", "بائقة", "كابوس", "تلاوة", "مذاعة", "مقالة", "مسمار", "باكورة", "مرساة", "مراجع", "كارثة", "تابوت", "شواغر", "نواهي", "نوايا", "غلاظة", "ريحان", "وجيزة", "نقاهة", "نكراء", "تاريخ", "طاغوت", "وسطاء", "ولادة", "ترضية", "توصية", "خضراء", "باحثة", "منطاد", "مقولة", "مجنحة", "مؤدبة", "تعيسة", "مبتسم", "وكلاء", "عنقاء", "تابعة", "نشطاء", "براقة", "ميزان", "ثرثار", "جيران", "باهية", "مطبوع", "توظيف", "فنجان", "ماضية", "مبسطة", "مصفاة", "قمامة", "حيوان", "جاسوس", "رمضان", "عصفور", "مهارة", "مشوشة", "تنقيب", "مترفة", "عزباء", "عذراء", "زعماء", "محلات", "ترقية", "تمائل", "ميلاد", "بلدان", "توضيح", "ريغان", "وسيمة", "مذاهب", "فضيحة", "مصونة", "مرجان", "مباحة", "متحور", "باعثة", "زملاء", "مثمرة", "مقدمة", "كرماء", "تسلية", "مشاكس", "عميقة", "مهينة", "توديع", "تشرذم", "توفير", "تاجرة", "وهنية", "قانون", "ملونة", "محدود", "لطفاء", "وصاية", "متعال", "مؤذية", "نظيفة", "شرفاء", "حمراء", "ناموس", "مأمون", "مسافر", "بدانة", "توصيل", "لفافة", "جاموس", "مباني", "فواكه", "صابون", "غلمان", "مجرات", "ثقافة", "تائبة", "تأسيس", "توفيق", "ميناء", "مجيدة", "وزراء", "مباحث", "وكيلة", "تضارب", "متيمة", "تسوية", "تائهة", "علماء", "ميقات", "معيشة", "بائعة", "ديوان", "صاروخ", "تعبئة", "فانوس", "تفاهة", "مأكول", "ماشية", "باهتة", "مؤيدة", "وكالة", "بطلان", "كنيسة", "مجدية", "قرنفل", "خواطر", "مجتاز", "غرامة", "معتدل", "عواطف", "زخارف", "ملامح", "عامود", "مناعة", "عصفور", "معلقة", "زرارة", "معقول", "زراعة", "تمثيل", "سداسي", "مهاجر", "جراحة", "معاكس", "شبيبة", "معابد", "مجاهد", "تجريب", "مواقد", "شريفة", "عنصري", "مساجد", "سلامة", "بطيخة", "سجادة", "رزيبة", "شحادة", "حفلات", "لطافة", "تعنيف", "متاحف", "راغبة", "معزوم", "تسلسل", "سلاحف", "مدارس", "مستور", "رباعي", "تعريف", "مواقف", "هيفاء", "ثخينة", "تحميل", "مكاتب", "علامة", "مواقع", "ثنائي", "لطيفة", "تسبيح", "مجالس", "توريد", "معاهد", "مصاحب", "رفيعة", "تحفيز", "مكتبة", "بوصلة", "كلمات", "دائرة", "مسموح", "شعراء", "زرعات", "سذاجة", "سميحة", "همسات", "جرافة", "دراجة", "مختبر", "مكياج", "مسلسل", "تصريح", "صحابة", "فارقة", "خماسي", "مجموع", "مثبتة", "ممتعة", "مماثل", "عائدة", "صناعة", "ممنوع", "مصاحف", "مكافح", "تقنية", "مجروح", "صحيحة", "فارسة", "شوائب", "ثلاثي", "مواكب", "زهراء", "سهولة", "متاجر", "صفراء", "خاطئة", "توهيد", "كهيلة", "الستة", "صعوبة", "مربعة", "مجوهر", "مقاعد", "مطروح", "مكتوب", "هادفة", "مدافع", "شبابي", "ترهيب", "جريح", "كهولة", "سجينة", "معدات", "لوحات", "هجرات", "عفراء", "مشاعر", "مرادف", "خنساء", "مدروس", "كواشف", "عباءة", "محتوى", "حلقات", "كريمة", "تسنيم", "مهنية", "شاحبة", "عصيبة", "مقتول", "موصول", "معينة", "محبوب", "باسطة", "سابقة", "مخطط", "جاهلة", "مقطور", "غفلان", "مجبور", "نشطاء", "مبعوث", "ظالمة", "محاول", "تورية", "مجاوز", "مخشية", "أجزاء", "مشيئة", "ثكلان", "موهوم", "ناضجة", "أعيان", "مغروم", "فاتحة", "منقوص", "فائحة", "مبروم", "حاكمة", "ميزان", "محسوب", "خطيرة", "محمول", "بارزة", "موشوم", "منطوق", "ساجدة", "مرصوص", "تيجان", "محمود", "إطراء", "مدموج", "ظافرة", "ملكوم", "عرفان", "مقصود", "مجزية", "إبداء", "مهنية", "واعدة", "تأميم", "لاقطة", "معدوم", "صابرة", "مكلوم", "طاعة", "مرزوق", "حاضنة", "متفوق", "ظاهرة", "تأويل", "شامخة", "تلقاء", "مبعوث", "فاحصة", "مأبون", "راسخة", "مجدوب", "طارحة", "ملموس", "نابعة", "مرسوم", "إبقاء", "مأثوم", "عمران", "حاسمة", "مراود", "محروق", "إذعان", "مثقوب", "واثقة", "محروم", "فائزة", "متبوع", "تنمية", "مخطط", "ناقضة", "مخصوص", "رجحان", "متذوق", "وجدان", "مأثور", "مجروح", "مليئة", "محفوف", "شاكرة", "خاتمة", "معمور", "صادقة", "صانعة", "محروس", "مصيدة", "شكران", "مقصور", "سامعة", "توشية", "ديوان", "مختوم", "زاهدة", "متكون", "مرينة", "معمول", "إرضاء", "متجول", "مريعة", "طلقاء", "متكور", "شافية", "محصور", "باهتة", "مخروط", "مدينة", "محظور", "ذؤبان", "مجرور", "سانحة", "أشجان", "مبرود", "واطئة", "محجوز", "سلطان", "مديدة", "مأذون", "صامتة", "مخدوش", "حاملة", "كتمان", "ساعية", "مبعوث", "حاصلة", "مجموع", "قربان", "مسموم", "أبناء", "مهزوز", "منصوص", "شاهقة", "محسوم", "ناطقة", "تأييد", "محاور", "تعميم", "أحباء", "مكيدة", "مأمون", "رادعة", "متلوف", "ناضرة", "مخبول", "ناضحة", "مبروك", "تسوية", "مقصوص", "عاجزة", "محسوس", "جدران", "متخوف", "مقبوض", "واعية", "محبور", "فاسدة", "محكوم", "لاصقة", "مبخوت", "صادمة", "محصود", "مخروق", "عادلة", "محبوس", "مأخوذ", "مقطوع", "مقذوف", "رهبان", "غامرة", "ثعبان", "متشوق", "ناجعة", "متقوس", "خاضعة", "محشور", "طاهرة", "محسود", "فرقان", "ملغوم", "سرعان", "مقطوف", "نبلاء", "مانعة", "محشود", "اتقان", "محصول", "مظلوم", "خافضة", "ملصوق", "ريغان", "مصقول", "محروز", "محدود", "سيلان", "متزوج", "إعلاء", "منقوض", "مريرة", "مجلوب", "حاشدة", "مأجور", "صاحبة", "متعوس", "ريحان", "مبغوض", "راجفة", "منقوط", "بارعة", "مجحود", "خارقة", "متلون", "صاعدة", "حازمة", "محظوظ", "صارخة", "مغمود", "هذيان", "متروك", "صبيان", "محموم", "باسمة", "محلول", "ساخطة", "محذوف", "غارقة", "تأمين", "داحضة", "معيبة", "بنيان", "مجعول", "ثاقبة", "مديون", "حائزة", "مبذول", "راجية", "محبوك", "نافثة", "مأجوج", "طاحنة", "مجزوم", "بسطاء", "محجور", "حامدة", "مجاور", "هابطة", "مثلوج", "سبحان", "عارمة", "نسيان", "مثبوت", "سرطان", "مأهول", "نيران", "مخطوب", "ناصعة", "محفور", "أخطاء", "مهيبة", "عدوان", "طامحة", "إعفاء", "مقروض", "عازفة", "غفران", "حافظة", "إقصاء", "بادرة", "محقون", "خادعة", "مهموم", "حاشرة", "عصيان", "سابحة", "مأمور", "إعطاء", "فارسة", "خافقة", "ثلاثة", "أربعة", "تذكرة", "شجيرة", "ضيافة", "تدفئة", "أسبوع", "أرواح", "ضوضاء", "أعضاء", "اثنان", "أسماء", "زمكان", "تدبير", "معجون", "تجميل", "رادار", "تقارب", "معماري", "تبريد", "طيبة", "لطيفة", "عذبة", "هادئة", "واضحة", "بهيجة", "رشيقة", "ناعمة", "صافية", "دافئة", "بسيطة", "شامخة", "كريمة", "صادقة", "وفية", "رزينة", "عطرة", "بهية", "نابعة", "غالية", "فخمة", "حذرة", "رقيقة", "سخية", "مهمة", "حكيمة", "مطلقة", "نبيلة", "مقدسة", "سعيدة", "غنية", "منيرة", "مشرقة", "فاضلة", "عاقلة", "واعية", "راقية", "سامية", "نقية", "زكية", "عفيفة", "شريفة", "وقورة", "هيوبة", "مهيبة", "جليلة", "عظيمة", "سمحة", "رحبة", "ودودة", "حنونة", "شفوقة", "رؤوفة", "غفورة", "ستارة", "حصيفة", "مدبرة", "محسنة", "منصفة", "متبعة", "قوامة", "حافظة", "ناصحة", "مرشدة", "موجهة", "كافية", "واقية", "عاصمة", "مانعة", "جاعلة", "رافعة", "خافضة", "قاضية", "حاكمة", "عادلة", "ناهية", "آمرة", "زاجرة", "وازعة", "رادعة", "صارمة", "لينة", "يانعة", "نامية", "واعدة", "باسطة", "قابضة", "نافعة
        ]);

        const gameState = {
            targetWord: "",
            currentRow: 0,
            currentGuess: "",
            gameOver: false,
            gameWon: false,
            stats: {
                played: 0,
                wins: 0,
                currentStreak: 0,
                maxStreak: 0,
                guessDistribution: [0, 0, 0, 0, 0, 0, 0, 0]
            }
        };

        // التهيئة
        function init() {
            loadStats();
            loadTheme();
            createGrid();
            createKeyboard();
            startNewGame();
            setupEventListeners();
            
            // ضبط الحجم الأولي
            adjustLayoutForScreen();
        }

        function loadStats() {
            const saved = localStorage.getItem('arwordle_stats');
            if (saved) {
                gameState.stats = JSON.parse(saved);
            }
        }

        function saveStats() {
            localStorage.setItem('arwordle_stats', JSON.stringify(gameState.stats));
        }

        function loadTheme() {
            const isDark = localStorage.getItem('arwordle_dark') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.querySelector('#themeToggle i').className = 'fas fa-sun text-xl';
            }
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'flex gap-2';
                rowDiv.id = `row-${row}`;
                
                for (let col = 0; col < 5; col++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.id = `tile-${row}-${col}`;
                    rowDiv.appendChild(tile);
                }
                
                grid.appendChild(rowDiv);
            }
        }

        function createKeyboard() {
            const keyboard = document.getElementById('keyboard');
            keyboard.innerHTML = '';
            
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // تصميم لوحة مفاتيح للجوال (4 صفوف)
                const mobileKeyboard = [
                    ["ض", "ص", "ث", "ق", "ف", "غ", "ع", "ه", "خ", "ح"],
                    ["ش", "س", "ي", "ب", "ل", "ا", "ت", "ن", "م", "ك"],
                    ["ذ", "ء", "ؤ", "ر", "ى", "ة", "و", "ز", "ظ", "ط"],
                    ["Enter", "⌫"]
                ];
                
                mobileKeyboard.forEach((row, rowIndex) => {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'key-row';
                    
                    // حساب عدد الأزرار في الصف
                    const keysInRow = row.length;
                    
                    row.forEach((keyChar, keyIndex) => {
                        const key = document.createElement('button');
                        
                        if (keyChar === 'Enter') {
                            key.textContent = 'تأكيد';
                            key.className = 'key wide bg-[#6ca965] text-white';
                            key.dataset.key = 'Enter';
                        } else if (keyChar === '⌫') {
                            key.textContent = '⌫';
                            key.className = 'key wide bg-[#818384] text-white';
                            key.dataset.key = 'Backspace';
                        } else {
                            key.textContent = keyChar;
                            key.className = 'key';
                            key.dataset.key = keyChar;
                        }
                        
                        // إضافة معرف فريد لكل زر
                        key.id = `key-${rowIndex}-${keyIndex}`;
                        
                        // إضافة مستمع الأحداث
                        key.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            handleInput(key.dataset.key);
                        });
                        
                        // تحسين للشاشات التي تعمل باللمس
                        key.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            key.style.opacity = '0.8';
                        }, { passive: false });
                        
                        key.addEventListener('touchend', (e) => {
                            e.preventDefault();
                            key.style.opacity = '1';
                            handleInput(key.dataset.key);
                        }, { passive: false });
                        
                        rowDiv.appendChild(key);
                    });
                    
                    keyboard.appendChild(rowDiv);
                });
            } else {
                // تصميم لوحة مفاتيح للكمبيوتر (3 صفوف)
                const desktopKeyboard = [
                    ["ض", "ص", "ث", "ق", "ف", "غ", "ع", "ه", "خ", "ح", "ج", "د"],
                    ["ش", "س", "ي", "ب", "ل", "ا", "ت", "ن", "م", "ك", "ط", "ئ"],
                    ["Enter", "ذ", "ء", "ؤ", "ر", "ى", "ة", "و", "ز", "ظ", "⌫"]
                ];
                
                desktopKeyboard.forEach((row, rowIndex) => {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'key-row';
                    
                    row.forEach((keyChar, keyIndex) => {
                        const key = document.createElement('button');
                        
                        if (keyChar === 'Enter') {
                            key.textContent = 'تأكيد';
                            key.className = 'key wide bg-[#6ca965] text-white';
                            key.dataset.key = 'Enter';
                        } else if (keyChar === '⌫') {
                            key.textContent = '⌫';
                            key.className = 'key wide bg-[#818384] text-white';
                            key.dataset.key = 'Backspace';
                        } else {
                            key.textContent = keyChar;
                            key.className = 'key';
                            key.dataset.key = keyChar;
                        }
                        
                        // إضافة معرف فريد لكل زر
                        key.id = `key-${rowIndex}-${keyIndex}`;
                        
                        // إضافة مستمع الأحداث
                        key.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            handleInput(key.dataset.key);
                        });
                        
                        // تحسين للشاشات التي تعمل باللمس
                        key.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            key.style.opacity = '0.8';
                        }, { passive: false });
                        
                        key.addEventListener('touchend', (e) => {
                            e.preventDefault();
                            key.style.opacity = '1';
                            handleInput(key.dataset.key);
                        }, { passive: false });
                        
                        rowDiv.appendChild(key);
                    });
                    
                    keyboard.appendChild(rowDiv);
                });
            }
        }

        function adjustLayoutForScreen() {
            const screenHeight = window.innerHeight;
            const screenWidth = window.innerWidth;
            const isMobile = screenWidth <= 768;
            
            // إعادة إنشاء لوحة المفاتيح إذا تغير حجم الشاشة
            if ((screenWidth <= 768 && !gameState.isMobile) || 
                (screenWidth > 768 && gameState.isMobile)) {
                gameState.isMobile = screenWidth <= 768;
                createKeyboard();
            }
            
            // إذا كانت الشاشة قصيرة جداً، قلل من الفجوات
            if (screenHeight < 600) {
                document.documentElement.style.setProperty('--tile-size', '2.2rem');
                document.documentElement.style.setProperty('--key-height', '2rem');
                document.querySelectorAll('.grid-rows-8').forEach(el => {
                    el.style.gap = '0.2rem';
                });
            }
        }

        function startNewGame() {
            // اختيار كلمة عشوائية
            const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
            let filteredWords = WORD_LIST.filter(word => word.length === 5);
            
            if (difficulty === 'easy') {
                filteredWords = filteredWords.filter(word => 
                    !word.includes('غ') && 
                    !word.includes('ظ') && 
                    !word.includes('ض') &&
                    !word.includes('ذ') &&
                    !word.includes('ث')
                );
            } else if (difficulty === 'hard') {
                filteredWords = filteredWords.filter(word => 
                    word.includes('غ') || 
                    word.includes('ظ') || 
                    word.includes('ض') ||
                    word.includes('ذ') ||
                    word.includes('ث')
                );
            }
            
            if (filteredWords.length === 0) {
                filteredWords = WORD_LIST.filter(word => word.length === 5);
            }
            
            gameState.targetWord = filteredWords[Math.floor(Math.random() * filteredWords.length)];
            gameState.currentRow = 0;
            gameState.currentGuess = '';
            gameState.gameOver = false;
            gameState.gameWon = false;
            
            // إعادة تعيين الشبكة
            document.querySelectorAll('.tile').forEach(tile => {
                tile.className = 'tile';
                tile.textContent = '';
            });
            
            // إعادة تعيين لوحة المفاتيح
            document.querySelectorAll('.key').forEach(key => {
                if (!key.classList.contains('wide')) {
                    key.className = key.className.replace(/(correct|present|absent)/g, '').trim();
                    key.classList.add('key');
                }
            });
            
            // إخفاء الرسالة
            document.getElementById('message').textContent = '';
        }

        function handleInput(key) {
            if (gameState.gameOver) return;
            
            console.log('Input received:', key); // Debug log
            
            if (key === 'Enter') {
                submitGuess();
            } else if (key === 'Backspace') {
                if (gameState.currentGuess.length > 0) {
                    gameState.currentGuess = gameState.currentGuess.slice(0, -1);
                    updateGrid();
                }
            } else if (gameState.currentGuess.length < 5) {
                // قبول الحروف العربية فقط
                if (/^[\u0600-\u06FF]$/.test(key)) {
                    gameState.currentGuess += key;
                    updateGrid();
                    
                    // تأثير ظهور الحرف
                    const tile = document.getElementById(`tile-${gameState.currentRow}-${gameState.currentGuess.length-1}`);
                    if (tile) {
                        tile.classList.add('filled');
                        setTimeout(() => tile.classList.remove('filled'), 100);
                    }
                }
            }
        }

        function updateGrid() {
            for (let i = 0; i < 5; i++) {
                const tile = document.getElementById(`tile-${gameState.currentRow}-${i}`);
                if (tile) {
                    tile.textContent = gameState.currentGuess[i] || '';
                }
            }
        }

        function submitGuess() {
            if (gameState.currentGuess.length !== 5) {
                showMessage('الكلمة يجب أن تكون 5 أحرف');
                shakeRow();
                return;
            }
            
            if (!isValidWord(gameState.currentGuess)) {
                showMessage('الكلمة غير موجودة في القاموس');
                shakeRow();
                return;
            }
            
            evaluateGuess();
        }

        function isValidWord(word) {
            return DICTIONARY.includes(word);
        }

        function evaluateGuess() {
            const guess = gameState.currentGuess;
            const target = gameState.targetWord;
            
            const result = Array(5).fill('absent');
            const targetLetters = {};
            
            for (const letter of target) {
                targetLetters[letter] = (targetLetters[letter] || 0) + 1;
            }
            
            for (let i = 0; i < 5; i++) {
                if (guess[i] === target[i]) {
                    result[i] = 'correct';
                    targetLetters[guess[i]]--;
                }
            }
            
            for (let i = 0; i < 5; i++) {
                if (result[i] !== 'correct' && targetLetters[guess[i]] > 0) {
                    result[i] = 'present';
                    targetLetters[guess[i]]--;
                }
            }
            
            for (let i = 0; i < 5; i++) {
                const tile = document.getElementById(`tile-${gameState.currentRow}-${i}`);
                const delay = i * 300;
                
                setTimeout(() => {
                    tile.classList.add('flip');
                    setTimeout(() => {
                        tile.classList.add(result[i]);
                        updateKeyboard(guess[i], result[i]);
                    }, 300);
                }, delay);
            }
            
            const won = guess === target;
            
            setTimeout(() => {
                if (won) {
                    gameState.gameWon = true;
                    gameState.gameOver = true;
                    handleWin();
                } else if (gameState.currentRow === 7) {
                    gameState.gameOver = true;
                    handleLoss();
                } else {
                    gameState.currentRow++;
                    gameState.currentGuess = '';
                }
            }, 1800);
        }

        function updateKeyboard(letter, status) {
            const key = document.querySelector(`.key[data-key="${letter}"]`);
            if (!key) return;
            
            if (status === 'correct') {
                key.classList.remove('present', 'absent');
                key.classList.add('correct');
            } else if (status === 'present' && !key.classList.contains('correct')) {
                key.classList.remove('absent');
                key.classList.add('present');
            } else if (status === 'absent' && !key.classList.contains('correct') && !key.classList.contains('present')) {
                key.classList.add('absent');
            }
        }

        function handleWin() {
            showMessage('🎉 أحسنت! لقد فزت!');
            gameState.stats.played++;
            gameState.stats.wins++;
            gameState.stats.currentStreak++;
            gameState.stats.maxStreak = Math.max(gameState.stats.maxStreak, gameState.stats.currentStreak);
            gameState.stats.guessDistribution[gameState.currentRow]++;
            
            saveStats();
            updateStatsDisplay();
            
            setTimeout(() => {
                showStats();
            }, 1500);
        }

        function handleLoss() {
            showMessage(`💔 الكلمة كانت: ${gameState.targetWord}`);
            gameState.stats.played++;
            gameState.stats.currentStreak = 0;
            
            saveStats();
            updateStatsDisplay();
            
            setTimeout(() => {
                showStats();
            }, 1500);
        }

        function showMessage(text) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.classList.add('bounce');
            setTimeout(() => messageEl.classList.remove('bounce'), 500);
        }

        function shakeRow() {
            const row = document.getElementById(`row-${gameState.currentRow}`);
            if (row) {
                row.classList.add('shake');
                setTimeout(() => row.classList.remove('shake'), 500);
            }
        }

        function showStats() {
            updateStatsDisplay();
            document.getElementById('statsModal').classList.remove('hidden');
        }

        function updateStatsDisplay() {
            document.getElementById('playedCount').textContent = gameState.stats.played;
            document.getElementById('winPercent').textContent = gameState.stats.played > 0 
                ? Math.round((gameState.stats.wins / gameState.stats.played) * 100) + '%'
                : '0%';
            document.getElementById('currentStreak').textContent = gameState.stats.currentStreak;
            document.getElementById('maxStreak').textContent = gameState.stats.maxStreak;
            
            const distContainer = document.getElementById('guessDistribution');
            distContainer.innerHTML = '';
            
            const maxDist = Math.max(...gameState.stats.guessDistribution);
            
            gameState.stats.guessDistribution.forEach((count, index) => {
                const bar = document.createElement('div');
                bar.className = 'stats-bar';
                bar.style.width = maxDist > 0 ? `${(count / maxDist) * 100}%` : '0%';
                bar.textContent = `${index + 1}: ${count}`;
                distContainer.appendChild(bar);
            });
        }

        function shareResult() {
            let shareText = `كلمة 🧩\n`;
            shareText += `النتيجة: ${gameState.gameWon ? gameState.currentRow + 1 : 'X'}/8\n`;
            
            for (let row = 0; row <= gameState.currentRow; row++) {
                for (let col = 0; col < 5; col++) {
                    const tile = document.getElementById(`tile-${row}-${col}`);
                    if (tile.classList.contains('correct')) {
                        shareText += '🟩';
                    } else if (tile.classList.contains('present')) {
                        shareText += '🟨';
                    } else if (tile.classList.contains('absent')) {
                        shareText += '⬛';
                    }
                }
                shareText += '\n';
            }
            
            shareText += '\n#كلمة #لعبة_كلمة';
            
            navigator.clipboard.writeText(shareText)
                .then(() => {
                    showMessage('تم نسخ النتيجة إلى الحافظة!');
                })
                .catch(() => {
                    showMessage('حدث خطأ في المشاركة');
                });
        }

        function setupEventListeners() {
            // معالجة إدخال لوحة المفاتيح الفعلية (للكمبيوتر)
            document.addEventListener('keydown', (e) => {
                if (gameState.gameOver) return;
                
                console.log('Key pressed:', e.key); // Debug log
                
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleInput('Enter');
                } else if (e.key === 'Backspace' || e.key === 'Delete') {
                    e.preventDefault();
                    handleInput('Backspace');
                } else if (/^[\u0600-\u06FF]$/.test(e.key)) {
                    handleInput(e.key);
                }
            });
            
            // ضبط التخطيط عند تغيير حجم الشاشة
            window.addEventListener('resize', adjustLayoutForScreen);
            window.addEventListener('orientationchange', adjustLayoutForScreen);
            
            // أزرار العناوين
            document.getElementById('helpBtn').addEventListener('click', () => {
                document.getElementById('helpModal').classList.remove('hidden');
            });
            
            document.getElementById('statsBtn').addEventListener('click', showStats);
            
            document.getElementById('settingsBtn').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.remove('hidden');
            });
            
            document.getElementById('themeToggle').addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const icon = document.querySelector('#themeToggle i');
                if (document.body.classList.contains('dark-mode')) {
                    icon.className = 'fas fa-sun text-xl';
                    localStorage.setItem('arwordle_dark', 'true');
                } else {
                    icon.className = 'fas fa-moon text-xl';
                    localStorage.setItem('arwordle_dark', 'false');
                }
            });
            
            // إغلاق النوافذ المنبثقة
            document.getElementById('closeHelp').addEventListener('click', () => {
                document.getElementById('helpModal').classList.add('hidden');
            });
            
            document.getElementById('closeStats').addEventListener('click', () => {
                document.getElementById('statsModal').classList.add('hidden');
            });
            
            document.getElementById('closeSettings').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.add('hidden');
            });
            
            // أزرار النوافذ المنبثقة
            document.getElementById('startGameBtn').addEventListener('click', () => {
                document.getElementById('helpModal').classList.add('hidden');
                startNewGame();
            });
            
            document.getElementById('newGameBtn').addEventListener('click', () => {
                document.getElementById('statsModal').classList.add('hidden');
                startNewGame();
            });
            
            document.getElementById('shareBtn').addEventListener('click', shareResult);
            
            document.getElementById('resetStatsBtn').addEventListener('click', () => {
                if (confirm('هل أنت متأكد من إعادة تعيين جميع الإحصائيات؟')) {
                    gameState.stats = {
                        played: 0,
                        wins: 0,
                        currentStreak: 0,
                        maxStreak: 0,
                        guessDistribution: [0, 0, 0, 0, 0, 0, 0, 0]
                    };
                    saveStats();
                    updateStatsDisplay();
                    showMessage('تم إعادة تعيين الإحصائيات');
                }
            });
            
            // تغيير الصعوبة
            document.querySelectorAll('input[name="difficulty"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    startNewGame();
                });
            });
            
            // إغلاق النوافذ المنبثقة بالنقر خارجها
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                    }
                });
            });
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
